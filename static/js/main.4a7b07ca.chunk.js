(this["webpackJsonpbc-wildfire-tracker"]=this["webpackJsonpbc-wildfire-tracker"]||[]).push([[0],{25:function(e){e.exports=JSON.parse('[{"fire_center_id":"166","id":"3","name":"Northwest"},{"fire_center_id":"165","id":"2","name":"Prince George"},{"fire_center_id":"164","id":"4","name":"Coastal"},{"fire_center_id":"163","id":"6","name":"Cariboo"},{"fire_center_id":"162","id":"5","name":"Kamloops"},{"fire_center_id":"161","id":"1","name":"Southeast"}]')},26:function(e,t,a){e.exports=a(80)},48:function(e,t,a){},49:function(e,t,a){},50:function(e,t,a){},51:function(e,t,a){},67:function(e,t,a){},68:function(e,t,a){},71:function(e,t,a){},72:function(e,t,a){},73:function(e,t,a){e.exports=a.p+"static/media/BentonSansCond-Regular.43cd4ac7.otf"},74:function(e,t,a){e.exports=a.p+"static/media/BentonSansCond-RegItalic.69a4217c.otf"},75:function(e,t,a){e.exports=a.p+"static/media/BentonSansCond-Bold.6f6753fd.otf"},76:function(e,t,a){e.exports=a.p+"static/media/BentonSansCond-BoldItalic.a6640d89.otf"},77:function(e,t,a){e.exports=a.p+"static/media/Shift-Bold.cdd38a86.otf"},78:function(e,t,a){e.exports=a.p+"static/media/Shift-BoldItalic.5c3edbfd.otf"},79:function(e,t,a){},80:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(11),i=a.n(o),s=a(12),c=a(2),p=a(3),l=a(5),u=a(4),d=a(8),f=a.n(d),m=a(6),h=a(7),g=a.n(h);a(48);var v=function(e){return"\n\t\t<div>\n\t\t\t<h3>".concat(e.GEOGRAPHIC,'</h3>\n\t\t\t<p class="status ').concat(e.FIRE_STATU.toLowerCase().replace(/\s/g,"-"),'">Status: ').concat(e.FIRE_STATU,"</p>\n\t\t\t<p>A fire of ").concat(function(e){var t=(e.CURRENT_SI/100).toFixed(2);return t<.01?"less than 0.01":t}(e)," square kilometres started on ").concat(e.ignition_date,".</p>\n\n\t\t\t<p>Suspected cause: ").concat(""===(t=e.FIRE_CAUSE)?"unknown":t.toLowerCase(),"</p>\n\t\t</div>\n\t");var t},_=(a(49),function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={},n.popup=new g.a.Popup({closeButton:!1,closeOnClick:!1}),n.showPopup=n.showPopup.bind(Object(m.a)(n)),n.hidePopup=n.hidePopup.bind(Object(m.a)(n)),n}return Object(p.a)(a,[{key:"componentDidMount",value:function(){var e=this.props.data;this.extent_calcuted=!1,this.range=this.props.range?this.props.range:[3,50],g.a.accessToken=this.props.config.accessToken,this.map=new g.a.Map({container:this.mapContainer,style:this.props.mapboxStyle,center:[this.props.center[1],this.props.center[0]],zoom:this.props.zoom}),e.features&&this.renderMap(e)}},{key:"componentDidUpdate",value:function(e){this.state.mapIsLoaded?this.props.data!==e.data&&this.map.getSource("wildfires").setData(this.props.data):this.renderMap(this.props.data)}},{key:"getExtent",value:function(e){var t=[];return e.forEach((function(e){t.push(parseFloat(e.properties.CURRENT_SI))})),[Math.min.apply(Math,t),Math.max.apply(Math,t)]}},{key:"hidePopup",value:function(){this.map.getCanvas().style.cursor="",this.popup.remove()}},{key:"mapRange",value:function(e,t,a){return t[0]+(a-e[0])*(t[1]-t[0])/(e[1]-e[0])}},{key:"prepData",value:function(e){var t=this;this.extent_calcuted||(this.extent=this.getExtent(e.features),this.extent_calcuted=!0),e.features.forEach((function(e,a){var n=t.mapRange(t.extent,t.range,e.properties.CURRENT_SI);e.properties.radius=4*Math.log(n)})),e.features.sort((function(e,t){return t.CURRENT_SI-e.CURRENT_SI}))}},{key:"setupPopupText",value:function(e){return v(e)}},{key:"showPopup",value:function(e){this.map.getCanvas().style.cursor="pointer";var t=this.setupPopupText(e.features[0].properties);this.popup.setLngLat(e.lngLat).setHTML(t).addTo(this.map)}},{key:"renderMap",value:function(e){var t=this;this.prepData(e),this.map.on("load",(function(){t.map.addSource("wildfires",{type:"geojson",data:e}),t.map.addLayer({id:"wildfires",type:"circle",source:"wildfires",paint:{"circle-color":["match",["get","FIRE_STATU"],"New","#DD2D25","Out of Control","#DD2D25","Being Held","#F26B21","Under Control","#0062A3","Out","#6D6E70","#F6B31C"],"circle-opacity":.7,"circle-radius":["*",["get","radius"],1],"circle-stroke-width":.5,"circle-stroke-color":"#FFF"}}),t.map.on("mouseenter","wildfires",t.showPopup),t.map.on("mouseleave","wildfires",t.hidePopup)})),this.setState({mapIsLoaded:!0})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{ref:function(t){return e.mapContainer=t}})}}]),a}(n.Component));a(50);var y=function(e){var t=function(e){var t={out_fires:0,new_fires:0,held_fires:0,controlled_fires:0,last_update:"Waiting for data..."};if(e.data.features){var a=e.data.features,n=a.reduce((function(e,t){return e+parseFloat(t.properties.CURRENT_SI)}),0);t.km_burned=(n/100).toFixed(0),t.total_fires=a.length+1,t.last_update=a.length>0?function(e){var t=new Date(parseInt(e)),a=(n=t.getUTCMonth(),["January","February","March","April","May","June","July","August","September","October","November","December"][parseInt(n)]);var n;return"".concat(a," ").concat(t.toLocaleDateString().split("/")[1],", ").concat(t.getUTCFullYear()," at ").concat(t.toLocaleTimeString())}(a[0].properties.last_update):"Not available";for(var r=0;r<a.length;++r)"New"===a[r].properties.FIRE_STATU|"Out of Control"===a[r].properties.FIRE_STATU|"Fire of Note"===a[r].properties.FIRE_STATU?t.new_fires++:"Being Held"===a[r].properties.FIRE_STATU?t.held_fires++:"Under Control"===a[r].properties.FIRE_STATU?t.controlled_fires++:t.out_fires++}return t}(e);return r.a.createElement("div",{className:"summary-box",onClick:e.toggleFireTypeHandler},r.a.createElement("h2",null,"Latest wildfire stats"),r.a.createElement("div",{className:"stat-box"},r.a.createElement("div",{className:"stat"},r.a.createElement("p",{className:"big-num new"},t.new_fires),r.a.createElement("p",{className:"label"},"New")),r.a.createElement("div",{className:"stat"},r.a.createElement("p",{className:"big-num being-held"},t.held_fires),r.a.createElement("p",{className:"label"},"Held")),r.a.createElement("div",{className:"stat"},r.a.createElement("p",{className:"big-num under-control"},t.controlled_fires),r.a.createElement("p",{className:"label"},"Controlled")),r.a.createElement("div",{className:"stat"},r.a.createElement("p",{className:"big-num out"},t.out_fires),r.a.createElement("p",{className:"label"},"Out*"))),r.a.createElement("p",{className:"note"},"*Tap toggles view"),r.a.createElement("p",{className:"last-update"},"Last updated: ",t.last_update))},E=(a(51),window.innerWidth>400?5:4),b=window.innerWidth>400?[51.184179,-121.752423]:[52.184179,-121.752423],T=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(c.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).map_options={center:b,classField:"FIRE_STATU",maxZoom:8,minZoom:3,zoom:E},e}return Object(p.a)(a,[{key:"render",value:function(){return r.a.createElement(n.Fragment,null,r.a.createElement("h1",null,"B.C. Wildfire Tracker"),r.a.createElement(_,{center:this.map_options.center,circleMarkerClassField:this.map_options.classField,config:this.props.config,container:"mapview",data:this.props.data,mapboxStyle:this.props.mapboxStyle,maxZoom:this.map_options.maxZoom,minZoom:this.map_options.minZoom,zoom:this.map_options.zoom}),r.a.createElement(y,{data:this.props.data_all,toggleFireTypeHandler:this.props.toggleFireTypeHandler}))}}]),a}(n.Component);a(24),a(67),n.Component,a(68);a(25),a(69),a(70),a(71);var w=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(c.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={data:[],data_all:[],data_fon:[]},e}return Object(p.a)(a,[{key:"componentDidMount",value:function(){var e=this;f.a.get(this.props.currentData).then((function(t){var a={type:"FeatureCollection",features:t.data.features.filter((function(e){return"Out"!==e.properties.FIRE_STATU}))};e.setState({data:a,data_all:t.data})})),this.toggleFireTypeHandler=this.toggleFireTypeHandler.bind(this)}},{key:"setupFiresOfNote",value:function(e){var t=this,a=[],n=e;a.push(f.a.get(this.props.fonData)),a.push(f.a.get(this.props.firePerimeters)),f.a.all(a).then((function(e){var a=[],r=e.filter((function(e){return e.config.url.includes("fon.json")})),o=e.filter((function(e){return e.config.url.includes("perimeters.json")}))[0].data;r[0].data.forEach((function(e,r){var i=t.mergeFireDetails(e,n.features),s=o.filter((function(e){return void 0!==i?e.properties.FIRE_NUMBE===i.FIRE_NUMBE:[]}));s.length>0?s[0].properties=i:s.push({properties:i,type:"non-feature"}),a.push(s[0])})),t.setState({data_fon:a})}))}},{key:"filterFireData",value:function(e){if("new"===e){var t=[];return this.state.data_all.features.forEach((function(a){var n=a.properties.FIRE_STATU.replace(/\s/g,"-").toLowerCase();n===e|"out-of-control"===n&&t.push(a)})),t}return this.state.data_all.features.filter((function(t){return t.properties.FIRE_STATU.replace(/\s/g,"-").toLowerCase()===e}))}},{key:"mergeFireDetails",value:function(e,t){var a;return t.forEach((function(t){t.properties.FIRE_ID===e.fire_id&&(a=Object(s.a)(Object(s.a)({},e),t.properties))})),a}},{key:"toggleFireTypeHandler",value:function(e){var t={type:"FeatureCollection"},a=e.target.className.split(" ")[1];a===this.state.data_displayed?(t.features=this.state.data_all.features.filter((function(e){return"Out"!==e.properties.FIRE_STATU})),a=null):"out"===a?(console.log("OUT"),t=this.state.data_all):t.features=this.filterFireData(a),this.setState({data_displayed:a,data:t})}},{key:"render",value:function(){return r.a.createElement(n.Fragment,null,r.a.createElement(T,{config:this.props.mapboxConfig,data:this.state.data,data_all:this.state.data_all,mapboxStyle:this.props.mapboxStyle,tiles:this.props.tiles,toggleFireTypeHandler:this.toggleFireTypeHandler}))}}]),a}(n.Component),F=(a(72),{accessToken:"pk.eyJ1IjoibmdyaWZmaXRocy1wb3N0bWVkaWEiLCJhIjoiY2p5eWluaDR1MHoycTNpbnZhYnE1ZGJ5YyJ9.ky9G5qVIJn0gz_y7tULp6Q"});var S=function(){return r.a.createElement(w,{fonData:"https://vs-postmedia-data.sfo2.digitaloceanspaces.com/fon.json",currentData:"https://vs-postmedia-data.sfo2.digitaloceanspaces.com/wildfires.json",firePerimeters:"https://vs-postmedia-data.sfo2.digitaloceanspaces.com/perimeters.json",mapboxConfig:F,mapboxStyle:"mapbox://styles/mapbox/outdoors-v11"})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(73),a(74),a(75),a(76),a(77),a(78),a(79);i.a.render(r.a.createElement(S,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[26,1,2]]]);
//# sourceMappingURL=main.4a7b07ca.chunk.js.map